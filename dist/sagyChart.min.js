/*! sagyChart 2014-06-24 by LiTao */
!function(a,b){var c=this;"function"==typeof define&&define.amd?define(b):"undefined"!=typeof module&&module.exports?module.exports=b():c[a]=b()}.call(this,"sagyChart",function(){function a(a){return"boolean"==typeof a}function b(a){return"string"==typeof a}function c(a){return"[object Array]"===u.call(a)}function d(a){return"[object Function]"===u.call(a)}function e(a){return"number"==typeof a}function f(a){var b;for(b in a)return!1;return!0}function g(){return"sagy"+F().toString(36).substring(2,6)}function h(a){throw new Error(a)}function i(a){console.log(a)}function j(a,b){var d,e,f=0;if(a){if(c(a))for(e=a.length;e>f&&(d=b.call(a[f],f,a[f]),d!==!1);f++);else for(f in a)if(d=b.call(a[f],f,a[f]),d===!1)break;return a}}function k(){var a,b=arguments.length,c={},d=function(a,b){var c,e;"object"!=typeof a&&(a={});for(e in b)b.hasOwnProperty(e)&&(c=b[e],a[e]=c&&"object"==typeof c&&"[object Array]"!==u.call(c)&&"number"!=typeof c.nodeType?d(a[e]||{},c):b[e]);return a};for(a=0;b>a;a++)c=d(c,arguments[a]);return c}function l(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.getTime()}function m(a,b){var c,d,e=parseFloat(a),f=!1;return isNaN(e)?b?null:"--":(0>e&&(f=!0,e*=-1),c=e>=1e4?1:e>=1e3?10:e>=100?100:e>=10?1e3:1e4,e=E(e*c)/c,b?f?-1*e:e:(d=e>=1e5?e.toExponential(1):e.toString(),f&&(d="-"+d),d))}function n(a,b){a&&(this.x=a),this.y=b}function o(a,c){var d,e=g(),f=c;return d=K.createElement("div"),d.setAttribute("id",e),b(c)&&(f=K.getElementById(c)),f.appendChild(d),a.chart.renderTo=e,new L.Chart(a)}function p(a,b){var c,d,e=b||1,f=a.length,g=a[0],h=a[1],i=a[f-1];if(1===f)return d=new Date(g),0===d.getMonth()&&1===d.getDate()?"year":1===d.getDate()?"month":"day";if(6*w>i-g)return"minute";switch(c=h-g,!0){case w*e>=c:return"hour";case x*e>=c:return"day";case y*e>=c:return"month";case c>y*e:return"year"}}function q(a,b){return function(){b[a].apply(b,arguments)}}function r(){this.init.apply(this,arguments)}var s="0.13.7",t={},u=t.toString,v=6e4,w=60*v,x=24*w,y=31*x,z=366*x,A={minute:v,hour:w,day:x,month:y,year:z},B={minute:"%M",hour:"%H",day:"%d",month:"%m",year:"%Y"},C={minute:"%M:%S",hour:"%H:%M",day:"%m.%d",month:"%Y.%m",year:"%Y"},D=Math,E=D.round,F=D.random,G=D.max,H=D.min,I=D.pow,J="object"==typeof window&&window||this,K=J.document,L=Highcharts,M=J.unitDocs={Wh:{lowerLevel:null,higherLevel:"kWh",ratio:1e3},kWh:{lowerLevel:"Wh",higherLevel:"MWh",ratio:1e3},MWh:{lowerLevel:"kWh",higherLevel:"GWh",ratio:1e3},GWh:{lowerLevel:"MWh",higherLevel:"TWh",ratio:1e3},TWh:{lowerLevel:"GWh",higherLevel:"PWh",ratio:1e3},PWh:{lowerLevel:"TWh",higherLevel:"EWh",ratio:1e3},EWh:{lowerLevel:"PWh",higherLevel:"ZWh",ratio:1e3},ZWh:{lowerLevel:"EWh",higherLevel:"YWh",ratio:1e3},YWh:{lowerLevel:"ZWh",higherLevel:null,ratio:1e3},W:{lowerLevel:null,higherLevel:"kW",ratio:1e3},kW:{lowerLevel:"W",higherLevel:"MW",ratio:1e3},MW:{lowerLevel:"kW",higherLevel:"GW",ratio:1e3},GW:{lowerLevel:"MW",higherLevel:"TW",ratio:1e3},TW:{lowerLevel:"GW",higherLevel:"PW",ratio:1e3},PW:{lowerLevel:"TW",higherLevel:"EW",ratio:1e3},EW:{lowerLevel:"PW",higherLevel:"ZW",ratio:1e3},ZW:{lowerLevel:"EW",higherLevel:"YW",ratio:1e3},YW:{lowerLevel:"ZW",higherLevel:null,ratio:1e3},"元":{lowerLevel:null,higherLevel:"万元",ratio:1e4},"万元":{lowerLevel:"元",higherLevel:"亿元",ratio:1e4},"亿元":{lowerLevel:"万元",higherLevel:null,ratio:1e4},g:{lowerLevel:null,higherLevel:"kg",ratio:1e3},kg:{lowerLevel:"g",higherLevel:"T",ratio:1e3},T:{lowerLevel:"kg",higherLevel:"kT",ratio:1e3},kT:{lowerLevel:"T",higherLevel:"MT",ratio:1e3},MT:{lowerLevel:"kT",higherLevel:null,ratio:1e3},"克":{lowerLevel:null,higherLevel:"千克",ratio:1e3},"千克":{lowerLevel:"克",higherLevel:"吨",ratio:1e3},"吨":{lowerLevel:"千克",higherLevel:"千吨",ratio:1e3},"千吨":{lowerLevel:"吨",higherLevel:"兆吨",ratio:1e3},"兆吨":{lowerLevel:"千吨",higherLevel:null,ratio:1e3},J:{lowerLevel:null,higherLevel:"kJ",ratio:1e3},kJ:{lowerLevel:"J",higherLevel:"MJ",ratio:1e3},MJ:{lowerLevel:"kJ",higherLevel:null,ratio:1e3},mL:{lowerLevel:null,higherLevel:"L",ratio:1e3},L:{lowerLevel:"mL",higherLevel:"m³",ratio:1e3},"m³":{lowerLevel:"L",higherLevel:null,ratio:1e3}};L.setOptions({global:{useUTC:!1}});var N=function(){var a=arguments,c=a[0],d=a[1];return b(c)&&(c={renderTo:a[0]}),new N.fn.init(c,d)};Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.map||(Array.prototype.map=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=new Array(c),e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)f in b&&(d[f]=a.call(e,b[f],f,b));return d});var O={chart:{backgroundColor:"rgba(255,0,0,0)",renderTo:"chart_container"},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{series:{turboThreshold:2e5,shadow:!1}},title:{text:null},xAxis:{tickWidth:0,lineWidth:0,title:{text:null},labels:{}},yAxis:{tickWidth:0,lineWidth:0,title:{text:null},labels:{}}},P={chartOption:O,renderTo:"",autoAxis:!0,autoTooltip:!1,autoAxisOption:{minute:10,hour:2,day:2,month:1,year:1},needClear:!0,useShortFormater:!0,subline:{enabled:!1,lines:[],renderTo:"",deviation:0},convertUnit:{enabled:!1,consistent:!1},ajaxOption:{url:"./chart",transferData:{},index:0,callback:null,pointHandler:null,isJson:!0}};return N.fn=N.prototype={sagyChart:s,constructor:N,init:function(a,c){var e,f,g,i=this;a.chartOption||h("chartOption为必选项!"),a.chartOption=k(O,a.chartOption),i.options=e=k(P,a),e.autoAxis&&(e.chartOption.xAxis.labels.formatter=i.axisFormatter(),e.chartOption.xAxis.tickPositioner=i.tickPositioner()),b(e.renderTo)&&!K.getElementById(e.renderTo)&&h("页面不存在id为"+e.renderTo+"的元素"),i.subline=g=new r(i,e.subline),i.showLine=q("show",g),i.hideLine=q("hide",g),i.adjustLine=q("adjust",g),f=o(e.chartOption,e.renderTo),i.chart=f,i.transferData=e.ajaxOption.transferData,i.version=s,d(c)&&c.call(i)},refresh:function(a,b){var c,e,f,g=this,j=g.options.ajaxOption;a&&(e=a.transferData?a:{transferData:a},c=k(j.transferData,e.transferData),j=k(j,e),j.transferData=c,g.options.ajaxOption=j),f=b?b:j.callback,$.ajax({type:"POST",datatype:"json",data:j.isJson?j.transferData:JSON.stringify(j.transferData),url:j.url,success:function(a){var b;a&&a.yData&&0!==a.yData.length?(g.setData(a,j.index),b=!0):(g.clearData(j.index),i("ajax:"+j.url+" return null"),b=!1),d(f)&&f.call(g,b,a)},error:function(){h("ajax:"+j.url+" error!")}})},setData:function(a,d){var g=this,i=g.subline,k=i.lines,l=g.chart,m=g.options,n=m.convertUnit.enabled?a.unit:null,o=~~d,q=a.xData,r=a.yData,s=!1,t=0;if(c(r)||h("返回json格式有误,yData必须是数组."),c(q)&&e(q[0])?s=!0:c(q)&&b(q[0])&&(s=!1,l.xAxis[0].update({categories:q})),(m.autoAxis||m.autoTooltip&&s)&&(g.options.timeType=p(q,m.axisRatio)),m.needClear&&g.clearData(),c(r)&&c(r[0]))for(t=0;t<r.length;t++)g.setValueOnly(q,r[t],t,s,n,a.optional);else g.setValueOnly(q,r,o,s,n,a.optional);m.subline.enabled&&(j(a.lines,function(a,b){k[a].value=b.value}),f(i.showed)||g.adjustLine())},setValueOnly:function(a,b,c,e,f,g){var h,k,m,o,p,q=this,r=q.chart,s=q.options,t=s.ajaxOption.pointHandler,u=r.series,v=[],w=null,x=l(new Date),y=0,z=function(a,b){return parseInt(a)===y?(o.optional=b,!1):void 0};for(f&&(h=q.convertUnitArr(b,f),q.unit=h.unit,b=h.data),s.ajaxOption.index=c,k=b.filter(function(a){return null!==a}),m=H.apply(D,k),p=G.apply(D,k),y=b.length-1;y>=0&&!(e&&a[y]<x);y--)if(null!==b[y]){w=y;break}for(y=0;y<b.length;y++)o=new n(e?a[y]:null,b[y]),d(t)&&(o.isMin=o.y===m,o.isMax=o.y===p,w===y&&(o.isLatest=!0),g&&j(g,z),t.call(o,q.options.ajaxOption)),o.y=null===o.y?null:E(100*o.y)/100,v.push(o);y=+c+(0>c?u.length:0),u[y]?u[y].setData(v):i("不存在的series,可能因为错误index.")},clearData:function(){var a,b,c=this.chart.series,d=arguments,f=c.length;0===d.length?j(c,function(a,b){b.setData(null)}):e(d[0])&&(a=d[0],a=a>f||-1*f>a?f-1:a,b=+a+(0>a?f:0),d[1]?c[b].destroy():c[b].setData(null))},axisFormatter:function(){var a=this,b=a.options,c=b.useShortFormater?B:C;return function(){return L.dateFormat(c[b.timeType],this.value)}},tickPositioner:function(){var a=this,b=a.options,c=b.autoAxisOption,d=function(a,c){var d=a.length;if(1>d)return[];for(var e=a[0],f=a[d-1],g=e,h=A[b.timeType],i=[e];f>g;)g+=h*c,i.push(g);return i};return function(){var a=this.series[0].xData;return d(a,c[b.timeType])}},destroy:function(){var a=this;a.chart.destroy(),a.chart=null,K.getElementById(a.options.renderTo).innerHTML=""},redraw:function(){var a=this;a.chart=new L.Chart(a.options.chartOption),a.refresh()}},N.fn.init.prototype=N.fn,N.fn.convertUnitArr=function(a,b){var c,d,e=this.options.convertUnit,g=this.subline,h=G.apply(D,a),i=M[b],k=b,l=10>h?-1:0,m=h,n=i,o=[];if(!i)return{data:a,unit:b};if(c=i.ratio,0===l)for(;m>=10*c&&(m/=c,M[n.higherLevel]);)k=n.higherLevel,l++,n=M[n.higherLevel];else k=i.lowerLevel;for(e.consistent&&e.convertedUnit?(k=e.convertedUnit,l=e.convertedLen):(e.convertedUnit=k,e.convertedLen=l),d=0;d<a.length;d++)null===a[d]?o.push(null):o.push(a[d]*I(c,-1*l));return f(g.showed)||j(g.lines,function(a,b){b.convertedValue=b.value*I(c,-1*l)}),{data:o,unit:k}},N.convertUnitArr=function(c,d){var e,f,g,h,i,j,k,l=arguments,n=M[d],o=d,p=n,q=!1;if(!n||!c)return{data:c,unit:d};if(l.length>2&&(b(l[2])?(k=l[2],q=!!l[3]):a(l[2])&&(q=l[2])),f=c.map(function(a){return k?a[k]:a}),e=G.apply(D,f),g=10>e?-1:0,h=e,i=n.ratio,0===g)for(;h>=10*i&&(h/=i,M[p.higherLevel]);)o=p.higherLevel,g++,p=M[p.higherLevel];else o=n.lowerLevel;for(j=0;j<c.length;j++)k?(h=c[j][k],c[j][k]=m(h*I(i,-1*g),q)):(h=c[j],c[j]=m(h*I(i,-1*g),q));return{data:c,unit:o}},N.fn.convertUnit=N.convertUnit=function(a,b,c){var d,e=b,f=M[b],g=10>a?-1:0,h=a,i=f;if(!f||!a)return{data:m(a,c),unit:b};if(d=f.ratio,0===g)for(;h>=10*d&&(h/=d,M[i.higherLevel]);)e=i.higherLevel,g++,i=M[i.higherLevel];else e=f.lowerLevel;return h=null==a?null:a*I(d,-1*g),{data:m(h,c),unit:e}},r.prototype={constructor:r,init:function(a,b){var c=this,d=b.lines;b.renderTo&&(c.node=K.getElementById(b.renderTo)),j(d,function(a,b){b.node=b.renderTo?K.getElementById(b.renderTo):c.node}),c.sagy=a,c.options=b,c.lines=d,c.showed={}},show:function(){var a=arguments,b=this,c=b.lines,d=b.showed;0===a.length?j(c,function(a,b){d["line"+a]=b,b.node&&(b.node.style.display="block")}):e(a[0])?j(a,function(a,b){d["line"+b]=c[b],c[b].node&&(c[b].node.style.display="block")}):j(a[0],function(a,b){d["line"+a]=c[a]=k(c[a],b),c[a].node&&(c[a].node.style.display="block")}),b.adjust()},hide:function(a){var b=this,c=b.sagy.chart.yAxis,d=b.showed;a=~~a,j(d,function(b){c[a].removePlotLine(b),d[b].node&&(d[b].node.style.display="none")}),d={}},adjust:function(){var a,b=this,c=b.showed,d=b.options.deviation,e=b.sagy.chart,f=e.plotTop,g=e.plotSizeY,h=e.yAxis;j(c,function(b,c){a=h[~~c.index],a.removePlotLine(b)}),j(c,function(b,c){var e,i,j,k=c.convertedValue||c.value;a=h[~~c.index],a.addPlotLine({color:c.color,dashStyle:"Solid",width:2,value:k,id:b,zIndex:99}),c.node&&(i=c.node,k>a.max?i.style.top=f-i.scrollHeight/2+d+"px":k<a.min?i.style.top=f+g-i.scrollHeight/2+d+"px":(j=a.plotLinesAndBands[a.plotLinesAndBands.length-1].svgElem,j.shadow(!0),e=j.d,f=e.split(" ",3)[2],i.style.top=f-i.scrollHeight/2+d+"px"))})}},N.numFormat=m,N.version=s,N});