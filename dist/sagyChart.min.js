/*! sagyChart 2014-08-06 by LiTao */
!function(a,b){var c=this;"function"==typeof define&&define.amd?define(b):"undefined"!=typeof module&&module.exports?module.exports=b():c[a]=b()}.call(this,"sagyChart",function(){function a(a){return"boolean"==typeof a}function b(a){return"string"==typeof a}function c(a){return"[object Array]"===t.call(a)}function d(a){return"[object Function]"===t.call(a)}function e(a){return"number"==typeof a}function f(a){var b;for(b in a)return!1;return!0}function g(a){throw new Error(a)}function h(a){console.log(a)}function i(a,b){var d,e,f=0;if(a){if(c(a))for(e=a.length;e>f&&(d=b.call(a[f],f,a[f]),d!==!1);f++);else for(f in a)if(d=b.call(a[f],f,a[f]),d===!1)break;return a}}function j(){var a,b=arguments.length,c={},d=function(a,b){var c,e;"object"!=typeof a&&(a={});for(e in b)b.hasOwnProperty(e)&&(c=b[e],a[e]=c&&"object"==typeof c&&"[object Array]"!==t.call(c)&&"number"!=typeof c.nodeType?d(a[e]||{},c):b[e]);return a};for(a=0;b>a;a++)c=d(c,arguments[a]);return c}function k(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.getTime()}function l(a,b){var c,d,e=parseFloat(a),f=!1;return isNaN(e)?b?null:"--":(0>e&&(f=!0,e*=-1),c=e>10?10:100,e=D(e*c)/c,b?f?-1*e:e:(d=e>=1e5?e.toExponential(1):e.toString(),f&&(d="-"+d),d))}function m(a,b){a&&(this.x=a),this.y=b}function n(a,b){return a.chart.renderTo=b,new K.Chart(a)}function o(a,b){var c,d,e=b||1,f=a.length,g=a[0],h=a[1],i=a[2],j=a[f-1];if(2>=f)return d=new Date(g),0===d.getMonth()&&1===d.getDate()?"year":1===d.getDate()?"month":"day";if(6*v>j-g)return"minute";switch(c=i-h,!0){case v*e>=c:return"hour";case w*e>=c:return"day";case x*e>=c:return"month";case c>x*e:return"year"}}function p(a,b){return function(){b[a].apply(b,arguments)}}function q(){this.init.apply(this,arguments)}var r="1.0.0",s={},t=s.toString,u=6e4,v=60*u,w=24*v,x=31*w,y={minute:u,hour:v,day:w},z={minute:"%H:%M",hour:"%H",day:"%d",month:"%m",year:"%Y"},A={minute:"%H:%M",hour:"%H:%M",day:"%m.%d",month:"%Y.%m",year:"%Y"},B=B,C=Math,D=C.round,E=(C.random,C.ceil),F=C.max,G=C.min,H=C.pow,I="object"==typeof window&&window||this,J=I.document,K=Highcharts,L=I.unitDocs={Wh:{lowerLevel:null,higherLevel:"kWh",ratio:1e3},kWh:{lowerLevel:"Wh",higherLevel:"MWh",ratio:1e3},MWh:{lowerLevel:"kWh",higherLevel:"GWh",ratio:1e3},GWh:{lowerLevel:"MWh",higherLevel:"TWh",ratio:1e3},TWh:{lowerLevel:"GWh",higherLevel:"PWh",ratio:1e3},PWh:{lowerLevel:"TWh",higherLevel:"EWh",ratio:1e3},EWh:{lowerLevel:"PWh",higherLevel:"ZWh",ratio:1e3},ZWh:{lowerLevel:"EWh",higherLevel:"YWh",ratio:1e3},YWh:{lowerLevel:"ZWh",higherLevel:null,ratio:1e3},W:{lowerLevel:null,higherLevel:"kW",ratio:1e3},kW:{lowerLevel:"W",higherLevel:"MW",ratio:1e3},MW:{lowerLevel:"kW",higherLevel:"GW",ratio:1e3},GW:{lowerLevel:"MW",higherLevel:"TW",ratio:1e3},TW:{lowerLevel:"GW",higherLevel:"PW",ratio:1e3},PW:{lowerLevel:"TW",higherLevel:"EW",ratio:1e3},EW:{lowerLevel:"PW",higherLevel:"ZW",ratio:1e3},ZW:{lowerLevel:"EW",higherLevel:"YW",ratio:1e3},YW:{lowerLevel:"ZW",higherLevel:null,ratio:1e3},"元":{lowerLevel:null,higherLevel:"万元",ratio:1e4},"万元":{lowerLevel:"元",higherLevel:"亿元",ratio:1e4},"亿元":{lowerLevel:"万元",higherLevel:null,ratio:1e4},g:{lowerLevel:null,higherLevel:"kg",ratio:1e3},kg:{lowerLevel:"g",higherLevel:"T",ratio:1e3},T:{lowerLevel:"kg",higherLevel:"kT",ratio:1e3},kT:{lowerLevel:"T",higherLevel:"MT",ratio:1e3},MT:{lowerLevel:"kT",higherLevel:null,ratio:1e3},"克":{lowerLevel:null,higherLevel:"千克",ratio:1e3},"千克":{lowerLevel:"克",higherLevel:"吨",ratio:1e3},"吨":{lowerLevel:"千克",higherLevel:"千吨",ratio:1e3},"千吨":{lowerLevel:"吨",higherLevel:"兆吨",ratio:1e3},"兆吨":{lowerLevel:"千吨",higherLevel:null,ratio:1e3},J:{lowerLevel:null,higherLevel:"kJ",ratio:1e3},kJ:{lowerLevel:"J",higherLevel:"MJ",ratio:1e3},MJ:{lowerLevel:"kJ",higherLevel:null,ratio:1e3},mL:{lowerLevel:null,higherLevel:"L",ratio:1e3},L:{lowerLevel:"mL",higherLevel:"m³",ratio:1e3},"m³":{lowerLevel:"L",higherLevel:null,ratio:1e3}};K.setOptions({global:{useUTC:!1}});var M=function(){var a=arguments,c=a[0],d=a[1];return b(c)&&(c={renderTo:a[0]}),new M.fn.init(c,d)};Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.map||(Array.prototype.map=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=new Array(c),e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)f in b&&(d[f]=a.call(e,b[f],f,b));return d});var N={chart:{backgroundColor:"rgba(255,0,0,0)",renderTo:"chart_container"},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{series:{turboThreshold:2e5,shadow:!1}},title:{text:null},xAxis:{tickWidth:0,lineWidth:0,title:{text:null},labels:{}},yAxis:{tickWidth:0,lineWidth:0,title:{text:null},labels:{}}},O={chartOption:N,renderTo:"",autoAxis:!0,autoTooltip:!1,autoAxisOption:{minute:10,hour:2,day:2,month:1,year:1},needClear:!0,useShortFormater:!0,subline:{enabled:!1,lines:[],renderTo:"",deviation:0},convertUnit:{enabled:!1,consistent:!1},ajaxOption:{url:"./chart",transferData:{},index:0,callback:null,pointHandler:null,isJson:!0}};return M.fn=M.prototype={sagyChart:r,constructor:M,init:function(a,c){var e,f,h=this;a.chartOption||g("chartOption为必选项!"),a.chartOption=j(N,a.chartOption),h.options=e=j(O,a),e.autoAxis&&(e.chartOption.xAxis.labels.formatter=h.axisFormatter(),e.chartOption.xAxis.tickPositioner=h.tickPositioner()),b(e.renderTo)&&!J.getElementById(e.renderTo)&&g("页面不存在id为"+e.renderTo+"的元素"),h.subline=f=new q(h,e.subline),h.showLine=p("show",f),h.hideLine=p("hide",f),h.adjustLine=p("adjust",f),h.chart=n(e.chartOption,e.renderTo),h.transferData=e.ajaxOption.transferData,h.version=r,d(c)&&c.call(h)},refresh:function(a,b){var c,e,f,i=this,k=i.options.ajaxOption;a&&(e=a.transferData?a:{transferData:a},c=j(k.transferData,e.transferData),k=j(k,e),k.transferData=c,i.options.ajaxOption=k,i.transferData=c),f=b?b:k.callback,$.ajax({type:"POST",datatype:"json",data:k.isJson?k.transferData:JSON.stringify(k.transferData),url:k.url,success:function(a){var b;a&&a.yData&&0!==a.yData.length?(i.setData(a,k.index),b=!0):(i.clearData(k.index),h("ajax:"+k.url+" return null"),b=!1),d(f)&&f.call(i,b,a)},error:function(){g("ajax:"+k.url+" error!")}})},setData:function(a,d){var h=this,j=h.subline,k=j.lines,l=h.chart,m=h.options,n=m.convertUnit.enabled?a.unit:null,p=~~d,q=a.xData,r=a.yData,s=!1,t=0;if(c(r)||g("返回json格式有误,yData必须是数组."),c(q)&&e(q[0])?s=!0:c(q)&&b(q[0])&&(s=!1,l.xAxis[0].update({categories:q})),m.autoAxis&&s&&(h.options.timeType=o(q,m.axisRatio)),m.needClear&&h.clearData(),q)if(c(r)&&c(r[0]))for(t=0;t<r.length;t++)h.setValueOnly(q,r[t],t,s,n,a.optional);else h.setValueOnly(q,r,p,s,n,a.optional);else l.series[p].setData(r);m.subline.enabled&&(i(a.lines,function(a,b){k[a].value=b.value}),f(j.showed)||h.adjustLine())},setValueOnly:function(a,b,c,e,f,g){var j,n,o,p,q,r=this,s=r.chart,t=r.options,u=t.ajaxOption.pointHandler,v=s.series,w=[],x=null,y=k(new Date),z=0,A=function(a,b){return B(a)===z?(p.optional=b,!1):void 0};for(f&&(j=r.convertUnitArr(b,f),r.unit=j.unit,b=j.data),t.ajaxOption.index=c,n=b.filter(function(a){return null!==a}),o=G.apply(C,n),q=F.apply(C,n),z=b.length-1;z>=0&&!(e&&a[z]<y);z--)if(null!==b[z]){x=z;break}for(z=0;z<b.length;z++)p=new m(e?a[z]:null,b[z]),d(u)&&(p.isMin=p.y===o,p.isMax=p.y===q,x===z&&(p.isLatest=!0),g&&i(g,A),u.call(p,r.options.ajaxOption)),p.y=l(p.y,!0),w.push(p);z=+c+(0>c?v.length:0),v[z]?v[z].setData(w):h("不存在的series,可能因为错误index.")},clearData:function(){var a,b,c=this.chart.series,d=arguments,f=c.length;0===d.length?i(c,function(a,b){b.setData(null)}):e(d[0])&&(a=d[0],a=a>f||-1*f>a?f-1:a,b=+a+(0>a?f:0),d[1]?c[b].destroy():c[b].setData(null))},axisFormatter:function(){var a=this,b=a.options,c=b.useShortFormater?z:A;return function(){return K.dateFormat(c[b.timeType],this.value)}},tickPositioner:function(){var a=this,b=a.options,c=b.autoAxisOption,d=function(a,c){var d=a.length;if(1>d)return[];var e,f,g,h,i=a[0],j=a[d-1],k=j-i;if(e=[i],f=i,"year"===b.timeType)for(g=new Date(f);j>f;)f=g.setFullYear(g.getFullYear()+1),g=new Date(f),j>=f&&e.push(f);else if("month"===b.timeType)for(g=new Date(f);j>f;)f=g.setMonth(g.getMonth()+1),g=new Date(f),j>=f&&e.push(f);else for(h=y[b.timeType]*c,k/c/y[b.timeType]>25&&(h*=E(k/c/y[b.timeType]/25));j>f;)f+=h,j>=f&&e.push(f);return e};return function(){var a=this.series[0].xData;return d(a,c[b.timeType])}},destroy:function(){var a=this;a.chart.destroy(),a.chart=null,J.getElementById(a.options.renderTo).innerHTML=""},redraw:function(){var a=this;a.chart=new K.Chart(a.options.chartOption),a.refresh()}},M.fn.init.prototype=M.fn,M.fn.convertUnitArr=function(a,b){var c,d,e=this.options.convertUnit,g=this.subline,h=F.apply(C,a),j=L[b],k=b,l=10>h?-1:0,m=h,n=j,o=[];if(!j)return{data:a,unit:b};if(c=j.ratio,0===l)for(;m>=10*c&&(m/=c,L[n.higherLevel]);)k=n.higherLevel,l++,n=L[n.higherLevel];else k=j.lowerLevel;for(e.consistent&&e.convertedUnit?(k=e.convertedUnit,l=e.convertedLen):(e.convertedUnit=k,e.convertedLen=l),d=0;d<a.length;d++)null===a[d]?o.push(null):o.push(a[d]*H(c,-1*l));return f(g.showed)||i(g.lines,function(a,b){b.convertedValue=b.value*H(c,-1*l)}),{data:o,unit:k}},M.convertUnitArr=function(c,d){var e,f,g,h,i,j,k,m=arguments,n=L[d],o=d,p=n,q=!1;if(!n||!c)return{data:c,unit:d};if(m.length>2&&(b(m[2])?(k=m[2],q=!!m[3]):a(m[2])&&(q=m[2])),f=c.map(function(a){return k?a[k]:a}),e=F.apply(C,f),g=10>e?-1:0,h=e,i=n.ratio,0===g)for(;h>=10*i&&(h/=i,L[p.higherLevel]);)o=p.higherLevel,g++,p=L[p.higherLevel];else o=n.lowerLevel;for(j=0;j<c.length;j++)k?(h=c[j][k],c[j][k]=l(h*H(i,-1*g),q)):(h=c[j],c[j]=l(h*H(i,-1*g),q));return{data:c,unit:o}},M.fn.convertUnit=M.convertUnit=function(a,b,c){var d,e=b,f=L[b],g=10>a?-1:0,h=a,i=f;if(!f||!a)return{data:l(a,c),unit:b};if(d=f.ratio,0===g)for(;h>=10*d&&(h/=d,L[i.higherLevel]);)e=i.higherLevel,g++,i=L[i.higherLevel];else e=f.lowerLevel;return h=null==a?null:a*H(d,-1*g),{data:l(h,c),unit:e}},q.prototype={constructor:q,init:function(a,b){var c=this,d=b.lines;b.renderTo&&(c.node=J.getElementById(b.renderTo)),i(d,function(a,b){b.node=b.renderTo?J.getElementById(b.renderTo):c.node}),c.sagy=a,c.options=b,c.lines=d,c.showed={}},show:function(){var a=arguments,b=this,c=b.lines,d=b.showed;0===a.length?i(c,function(a,b){d["line"+a]=b,b.node&&(b.node.style.display="block")}):e(a[0])?i(a,function(a,b){d["line"+b]=c[b],c[b].node&&(c[b].node.style.display="block")}):i(a[0],function(a,b){d["line"+a]=c[a]=j(c[a],b),c[a].node&&(c[a].node.style.display="block")}),b.adjust()},hide:function(a){var b=this,c=b.sagy.chart.yAxis,d=b.showed;a=~~a,i(d,function(b){c[a].removePlotLine(b),d[b].node&&(d[b].node.style.display="none")}),d={}},adjust:function(){var a,b=this,c=b.showed,d=b.options.deviation,e=b.sagy.chart,f=e.plotTop,g=e.plotSizeY,h=e.yAxis;i(c,function(b,c){a=h[~~c.index],a.removePlotLine(b)}),i(c,function(b,c){var e,i,j,k=c.convertedValue||c.value;a=h[~~c.index],a.addPlotLine({color:c.color,dashStyle:"Solid",width:2,value:k,id:b,zIndex:99}),c.node&&(i=c.node,k>a.max?i.style.top=f-i.scrollHeight/2+d+"px":k<a.min?i.style.top=f+g-i.scrollHeight/2+d+"px":(j=a.plotLinesAndBands[a.plotLinesAndBands.length-1].svgElem,j.shadow(!0),e=j.d,f=e.split(" ",3)[2],i.style.top=f-i.scrollHeight/2+d+"px"))})}},M.numFormat=l,M.version=r,M});