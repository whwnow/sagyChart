/*! sagyChart 2014-04-16 by LiTao */
!function(a,b){var c=this;"function"==typeof define&&define.amd?define(b):"undefined"!=typeof module&&module.exports?module.exports=b():c[a]=b()}.call(this,"sagyChart",function(){function a(a){return"string"==typeof a}function b(a){return"[object Array]"===u.call(a)}function c(a){return"[object Function]"===u.call(a)}function d(a){return"number"==typeof a}function e(a){var b;for(b in a)return!1;return!0}function f(){return"sagy"+B().toString(36).substring(2,6)}function g(a){throw new Error(a)}function h(a){console.log(a)}function i(a,c){var d,e,f=0;if(a){if(b(a))for(e=a.length;e>f&&(d=c.call(a[f],f,a[f]),d!==!1);f++);else for(f in a)if(d=c.call(a[f],f,a[f]),d===!1)break;return a}}function j(){var a,b=arguments.length,c={},d=function(a,b){var c,e;"object"!=typeof a&&(a={});for(e in b)b.hasOwnProperty(e)&&(c=b[e],a[e]=c&&"object"==typeof c&&"[object Array]"!==u.call(c)&&"number"!=typeof c.nodeType?d(a[e]||{},c):b[e]);return a};for(a=0;b>a;a++)c=d(c,arguments[a]);return c}function k(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.getTime()}function l(a,b){var c,d,e=parseFloat(a),f=!1;return isNaN(e)?b?null:"--":(0>e&&(f=!0,e*=-1),c=e>=1e4?1:e>=1e3?10:e>=100?100:e>=10?1e3:1e4,e=A(e*c)/c,b?f?-1*e:e:(d=e>=1e5?e.toExponential(1):e.toString(),f&&(d="-"+d),d))}function m(a,b){a&&(this.x=a),this.y=b}function n(b,c){var d,e=f(),g=c;return d=G.createElement("div"),d.setAttribute("id",e),a(c)&&(g=G.getElementById(c)),g.appendChild(d),b.chart.renderTo=e,new H.Chart(b)}function o(a,b,c){var d,e,f=c||1;if(!b)return e=new Date(a),0===e.getMonth()&&1===e.getDate()?4:2;switch(d=b-a,!0){case w*f>=d:return 1;case x*f>=d:return 2;case y*f>=d:return 3;case d>y*f:return 4}}function p(a,b,c){var d,e,f,g,i=0,j=a.length,k=0;if(1===c)i=w;else{if(2!==c)return;i=x}if(2>j)return h("x轴长度小于2"),void 0;for(f=a[j-1],e=a[j-2],d=f-e,g=parseInt(d/i)-1,e-=e%i,k=0;g>k&&(e+=i,!(e>=f));k++)a.splice(-1,0,e),b.splice(-1,0,null)}function q(a,b){return function(){b[a].apply(b,arguments)}}function r(){this.init.apply(this,arguments)}var s="0.12.2",t={},u=t.toString,v=6e4,w=60*v,x=24*w,y=31*x,z=Math,A=z.round,B=z.random,C=z.max,D=z.min,E=z.pow,F="object"==typeof window&&window||this,G=F.document,H=Highcharts,I=F.unitDocs={Wh:{lowerLevel:null,higherLevel:"kWh",ratio:1e3},kWh:{lowerLevel:"Wh",higherLevel:"MWh",ratio:1e3},MWh:{lowerLevel:"kWh",higherLevel:"GWh",ratio:1e3},GWh:{lowerLevel:"MWh",higherLevel:"TWh",ratio:1e3},TWh:{lowerLevel:"GWh",higherLevel:"PWh",ratio:1e3},PWh:{lowerLevel:"TWh",higherLevel:"EWh",ratio:1e3},EWh:{lowerLevel:"PWh",higherLevel:"ZWh",ratio:1e3},ZWh:{lowerLevel:"EWh",higherLevel:"YWh",ratio:1e3},YWh:{lowerLevel:"ZWh",higherLevel:null,ratio:1e3},W:{lowerLevel:null,higherLevel:"kW",ratio:1e3},kW:{lowerLevel:"W",higherLevel:"MW",ratio:1e3},MW:{lowerLevel:"kW",higherLevel:"GW",ratio:1e3},GW:{lowerLevel:"MW",higherLevel:"TW",ratio:1e3},TW:{lowerLevel:"GW",higherLevel:"PW",ratio:1e3},PW:{lowerLevel:"TW",higherLevel:"EW",ratio:1e3},EW:{lowerLevel:"PW",higherLevel:"ZW",ratio:1e3},ZW:{lowerLevel:"EW",higherLevel:"YW",ratio:1e3},YW:{lowerLevel:"ZW",higherLevel:null,ratio:1e3},"元":{lowerLevel:null,higherLevel:"万元",ratio:1e4},"万元":{lowerLevel:"元",higherLevel:"亿元",ratio:1e4},"亿元":{lowerLevel:"万元",higherLevel:null,ratio:1e4},g:{lowerLevel:null,higherLevel:"kg",ratio:1e3},kg:{lowerLevel:"g",higherLevel:"T",ratio:1e3},T:{lowerLevel:"kg",higherLevel:"kT",ratio:1e3},kT:{lowerLevel:"T",higherLevel:"MT",ratio:1e3},MT:{lowerLevel:"kT",higherLevel:null,ratio:1e3},"克":{lowerLevel:null,higherLevel:"千克",ratio:1e3},"千克":{lowerLevel:"克",higherLevel:"吨",ratio:1e3},"吨":{lowerLevel:"千克",higherLevel:"千吨",ratio:1e3},"千吨":{lowerLevel:"吨",higherLevel:"兆吨",ratio:1e3},"兆吨":{lowerLevel:"千吨",higherLevel:null,ratio:1e3},J:{lowerLevel:null,higherLevel:"kJ",ratio:1e3},kJ:{lowerLevel:"J",higherLevel:"MJ",ratio:1e3},MJ:{lowerLevel:"kJ",higherLevel:null,ratio:1e3},L:{lowerLevel:null,higherLevel:"T",ratio:1e3},"m³":{lowerLevel:"L",higherLevel:null,ratio:1e3}},J=function(){var b=arguments,c=b[0],d=b[1];return a(c)&&(c={renderTo:b[0]}),new J.fn.init(c,d)};Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d});var K=function(){var a=this.series.chart;a.hoverPoint&&L.call(this),a.svg_yRect=a.renderer.image(a.resourcePath+"panel_Y.png",a.plotLeft-80,this.plotY+a.plotTop-21,80,50).attr({fill:"white",zIndex:99}).add();var b,c=l(this.y),d=c.length>4?20:28,e=d+"px";switch(a.svg_yText=a.renderer.text(c,a.plotLeft-43,this.plotY+a.plotTop+d/2).attr({zIndex:100,"text-anchor":"middle"}).css({color:"white",fontSize:e}).add(),a.svg_xRect=a.renderer.image(a.resourcePath+"panel_X.png",a.plotLeft+this.plotX-52,a.plotTop+a.plotHeight,102,60).attr({fill:"white",zIndex:99}).add(),a.timeType){case 1:b=H.dateFormat("%H:%M",this.x);break;case 2:b=H.dateFormat("%H:%M",this.x);break;case 3:case 4:b=H.dateFormat("%m.%d",this.x);break;case 5:b=H.dateFormat("%m",this.x);break;default:b=H.dateFormat("%H:%M",this.x)}a.svg_xText=a.renderer.text(b,a.plotLeft+this.plotX,a.plotTop+a.plotHeight+45).attr({zIndex:100,"text-anchor":"middle"}).css({color:"white",fontSize:"32px"}).add(),a.hoverPoint=this},L=function(){var a=this.series.chart;a.svg_xText&&(a.svg_xText.destroy(),a.svg_xRect.destroy(),a.svg_yText.destroy(),a.svg_yRect.destroy(),a.svg_xText=null,a.svg_xRect=null,a.svg_yText=null,a.svg_yRect=null),a.hoverPoint=null},M=function(){var a,b=this.chart,c=b.series[0].xData,d=function(a,b){for(var c=a.length,d=1,e=[],f=0;c/d>b;)d++;for(f=0;c>f;f+=d)e.push(a[f]);return e};switch(b.timeType){case 1:a=d(c,12);break;case 2:a=d(c,16);break;case 3:a=d(c,31);break;case 4:a=d(c,31);break;default:a=null}return a},N=function(){var a=this.chart,b=null;switch(a.timeType){case 1:b=H.dateFormat("%H:%M",this.value);break;case 2:b=H.dateFormat("%m.%d",this.value);break;case 3:b=H.dateFormat("%m",this.value);break;case 4:b=H.dateFormat("%Y",this.value)}return b},O={chart:{backgroundColor:"rgba(255,0,0,0)",renderTo:"chart_container"},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{series:{turboThreshold:2e5,stickyTracking:!0,shadow:!1}},title:{text:null},xAxis:{tickLength:0,tickWidth:0,lineWidth:0,title:{text:null}},yAxis:{tickWidth:0,lineWidth:0,title:{text:null}}},P={chartOption:O,renderTo:"",resourcePath:"./images/sagyChart/",autoAxis:!1,autoTooltip:!1,needClear:!0,subline:{enabled:!1,lines:[],renderTo:"",deviation:0},convertUnit:{enabled:!0,consistent:!1},ajaxOption:{url:"./chart",transferData:{},index:0,callback:null,pointHandler:null,isJson:!0}};return J.fn=J.prototype={sagyChart:s,constructor:J,init:function(b,d){var e,f,h,i=this;b.chartOption||g("chartOption为必选项!"),b.chartOption=j(O,b.chartOption),e=j(P,b),e.autoAxis&&(e.chartOption.xAxis.labels.formatter=N,e.chartOption.xAxis.tickPositioner=M),e.autoTooltip&&(e.chartOption.plotOptions.series.point.events.mouseOver.mouseOut=K,e.chartOption.plotOptions.series.point.events.mouseOut=L),a(e.renderTo)&&!G.getElementById(e.renderTo)&&g("页面不存在id为"+e.renderTo+"的元素"),i.subline=h=new r(i,e.subline),i.showLine=q("show",h),i.hideLine=q("hide",h),i.adjustLine=q("adjust",h),f=n(e.chartOption,e.renderTo),f.resourcePath=e.resourcePath,i.options=e,i.chart=f,i.transferData=e.ajaxOption.transferData,i.version=s,c(d)&&d.call(i)},refresh:function(a,b){var d,e,f,i=this,k=i.options.ajaxOption;a&&(e=a.transferData?a:{transferData:a},d=j(k.transferData,e.transferData),k=j(k,e),k.transferData=d,i.options.ajaxOption=k),f=b?b:k.callback,$.ajax({type:"POST",datatype:"json",data:k.isJson?k.transferData:JSON.stringify(k.transferData),url:k.url,success:function(a){var b;a&&a.yData&&0!==a.yData.length?(i.setData(a,k.index),b=!0):(i.clearData(k.index),h("ajax:"+k.url+" return null"),b=!1),c(f)&&f.call(i,b)},error:function(){g("ajax:"+k.url+" error!")}})},setData:function(c,f){var h=this,j=h.subline,k=j.lines,l=h.chart,m=h.options,n=~~f,q=c.xData,r=c.yData,s=!1,t=0;if(b(r)||g("返回json格式有误,yData必须是数组."),b(q)&&d(q[0])?s=!0:b(q)&&a(q[0])&&(s=!1,l.xAxis[0].update({categories:q})),(m.autoAxis||m.autoTooltip&&s)&&(l.timeType=o(q[t],q[t+1],m.axisRatio),p(q,r,l.timeType)),m.needClear&&h.clearData(),b(r)&&b(r[0]))for(t=0;t<r.length;t++)h.setValueOnly(q,r[t],t,s,c.unit,c.optional);else h.setValueOnly(q,r,n,s,c.unit,c.optional);m.subline.enabled&&(i(c.lines,function(a,b){k[a].value=b.value}),e(j.showed)||h.adjustLine())},setValueOnly:function(a,b,d,e,f,h){var j,l,n,o,p,q,r=this,s=r.chart,t=r.options,u=t.ajaxOption.pointHandler,v=s.series,w=!0,x=[],y=0,B=function(a,b){return parseInt(a)===y?(o.optional=b,!1):void 0};for(f&&(j=r.convertUnitArr(b,f),r.unit=j.unit,b=j.data),t.ajaxOption.index=d,l=b.filter(function(a){return null!==a}),n=D.apply(z,l),p=C.apply(z,l),y=0;y<b.length;y++)o=new m(e?a[y]:null,b[y]),c(u)&&(o.isMin=o.y===n,o.isMax=o.y===p,h&&i(h,B),u.call(o,r.options.ajaxOption)),o.y=null===o.y?null:A(100*o.y)/100,x.push(o);for(y=x.length-1;y>=0;y--)q=x[y],e&&w&&null!==q.y&&q.x>k(new Date)?(w=!1,q.isLatest=!0):q.isLatest=!1;y=+d+(0>d?v.length:0),v[y]?v[y].setData(x):g("不存在的series,可能因为错误index.")},clearData:function(){var a,b,c=this.chart.series,e=arguments,f=c.length;0===e.length?i(c,function(a,b){b.setData(null)}):d(e[0])&&(a=e[0],a=a>f||-1*f>a?f-1:a,b=+a+(0>a?f:0),e[1]?c[b].destroy():c[b].setData(null))},destroy:function(){var a=this;a.chart.destroy(),a.chart=null,G.getElementById(a.options.renderTo).innerHTML=""},redraw:function(){var a=this;a.chart=new H.Chart(a.options.chartOption),a.refresh()}},J.fn.init.prototype=J.fn,J.fn.convertUnitArr=function(a,b){var c,d,f=this.options.convertUnit,g=this.subline,h=C.apply(z,a),j=I[b],k=b,l=10>h?-1:0,m=h,n=j,o=[];if(!j)return{data:a,unit:b};if(c=j.ratio,0===l)for(;m>=10*c&&(m/=c,I[n.higherLevel]);)k=n.higherLevel,l++,n=I[n.higherLevel];else k=j.lowerLevel;for(f.consistent&&f.convertedUnit?(k=f.convertedUnit,l=f.convertedLen):(f.convertedUnit=k,f.convertedLen=l),d=0;d<a.length;d++)null===a[d]?o.push(null):o.push(a[d]*E(c,-1*l));return e(g.showed)||i(g.lines,function(a,b){b.convertedValue=b.value*E(c,-1*l)}),{data:o,unit:k}},J.fn.convertUnit=J.convertUnit=function(a,b,c){var d,e=b,f=I[b],g=10>a?-1:0,h=a,i=f;if(!f||isNaN(a))return{data:a,unit:b};if(d=f.ratio,0===g)for(;h>=10*d&&(h/=d,I[i.higherLevel]);)e=i.higherLevel,g++,i=I[i.higherLevel];else e=f.lowerLevel;return h=null==a?null:a*E(d,-1*g),{data:l(h,c),unit:e}},r.prototype={constructor:r,init:function(a,b){var c=this,d=b.lines;b.renderTo&&(c.node=G.getElementById(b.renderTo)),i(d,function(a,b){b.node=b.renderTo?G.getElementById(b.renderTo):c.node}),c.sagy=a,c.options=b,c.lines=d,c.showed={}},show:function(){var a=arguments,b=this,c=b.lines,e=b.showed;0===a.length?i(c,function(a,b){e["line"+a]=b,b.node&&(b.node.style.display="block")}):d(a[0])?i(a,function(a,b){e["line"+b]=c[b],c[b].node&&(c[b].node.style.display="block")}):i(a[0],function(a,b){e["line"+a]=c[a]=j(c[a],b),c[a].node&&(c[a].node.style.display="block")}),b.adjust()},hide:function(a){var b=this,c=b.sagy.chart.yAxis,d=b.showed;a=~~a,i(d,function(b){c[a].removePlotLine(b),d[b].node&&(d[b].node.style.display="none")}),d={}},adjust:function(){var a,b=this,c=b.showed,d=b.options.deviation,e=b.sagy.chart,f=e.plotTop,g=e.plotSizeY,h=e.yAxis;i(c,function(b,c){a=h[~~c.index],a.removePlotLine(b)}),i(c,function(b,c){var e,i,j,k=c.convertedValue||c.value;a=h[~~c.index],a.addPlotLine({color:c.color,dashStyle:"Solid",width:2,value:k,id:b,zIndex:99}),c.node&&(i=c.node,k>a.max?i.style.top=f-i.scrollHeight/2+d+"px":k<a.min?i.style.top=f+g-i.scrollHeight/2+d+"px":(j=a.plotLinesAndBands[a.plotLinesAndBands.length-1].svgElem,j.shadow(!0),e=j.d,f=e.split(" ",3)[2],i.style.top=f-i.scrollHeight/2+d+"px"))})}},J.numFormat=l,J.version=s,J});